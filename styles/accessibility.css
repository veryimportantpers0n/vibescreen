/* VibeScreen Accessibility Enhancements */

/* Screen Reader Only Content */
.sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* High Contrast Mode Enhancements */
@media (prefers-contrast: high) {
  :root {
    --matrix-green: #00FF00;
    --matrix-green-dim: #00DD00;
    --matrix-green-dark: #008800;
    --matrix-green-bright: #88FF88;
    --terminal-black: #000000;
    --terminal-dark: #111111;
    --phosphor-glow: #00FF00;
  }

  .message-popup {
    border-width: 3px !important;
    background: rgba(0, 0, 0, 0.98) !important;
    box-shadow: 
      0 0 15px var(--matrix-green),
      inset 0 0 15px rgba(0, 255, 0, 0.3) !important;
  }

  .message-popup[data-high-contrast="true"] {
    border-width: 4px !important;
    background: #000000 !important;
  }

  .message-popup-prompt {
    font-weight: 900 !important;
    text-shadow: none !important;
    color: var(--matrix-green-bright) !important;
  }

  .message-popup-content {
    font-weight: 700 !important;
    color: var(--matrix-green) !important;
    text-shadow: none !important;
  }

  .message-popup:focus {
    outline: 3px solid var(--matrix-green-bright) !important;
    outline-offset: 3px !important;
    border-color: var(--matrix-green-bright) !important;
  }

  .message-popup-tail {
    border-width: 10px !important;
    filter: none !important;
  }

  .message-popup-mode-corporate-ai[data-high-contrast="true"] {
    --mode-color: #0099FF !important;
  }

  .message-popup-mode-zen-monk[data-high-contrast="true"] {
    --mode-color: #00FF88 !important;
  }

  .message-popup-mode-chaos[data-high-contrast="true"] {
    --mode-color: #FF00FF !important;
  }


/* Reduced Motion Preferences */
@media (prefers-reduced-motion: reduce) {
  .message-popup,
  .message-popup * {
    animation: none !important;
    transition: none !important;
  }

  .message-popup[data-reduced-motion="true"] {
    animation: none !important;
    transition: opacity 0.1s ease !important;
  }

  .message-popup-entering[data-reduced-motion="true"] {
    opacity: 1 !important;
    transform: scale(1) translateY(0) !important;
  }

  .message-popup-exiting[data-reduced-motion="true"] {
    opacity: 0 !important;
    transform: scale(1) translateY(0) !important;
  }

  .message-popup-prompt[data-reduced-motion="true"] {
    animation: none !important;
  }

  .message-popup-animation-typing[data-reduced-motion="true"] .message-popup-content {
    width: 100% !important;
    border-right: none !important;
    animation: none !important;
  }

  .message-popup-animation-glitchy[data-reduced-motion="true"] {
    animation: none !important;
    filter: none !important;
    transform: none !important;
  }

  .message-popup-scan-lines[data-reduced-motion="true"]::before {
    display: none !important;
  }

  .message-popup-phosphor-persistence[data-reduced-motion="true"]::after {
    display: none !important;
  }
}

/* Enhanced Focus Management with Keyboard Navigation */
.message-popup:focus {
  outline: 2px solid var(--matrix-green-bright);
  outline-offset: 2px;
  box-shadow: 
    0 0 0 4px rgba(0, 255, 0, 0.3),
    0 0 30px var(--phosphor-glow),
    inset 0 0 30px rgba(0, 255, 0, 0.15);
  z-index: calc(var(--z-ui) + 50) !important;
}

.message-popup:focus-visible {
  outline: 3px solid var(--matrix-green-bright);
  outline-offset: 3px;
  box-shadow: 
    0 0 0 6px rgba(0, 255, 0, 0.4),
    0 0 40px var(--phosphor-glow),
    inset 0 0 40px rgba(0, 255, 0, 0.2);
}

.message-popup[data-focused="true"] {
  border-color: var(--matrix-green-bright);
  box-shadow: 
    0 0 25px var(--matrix-green-bright),
    0 0 50px rgba(0, 255, 0, 0.4),
    inset 0 0 25px rgba(0, 255, 0, 0.2);
}

/* Enhanced Keyboard Navigation for All Interactive Elements */
button:focus,
input:focus,
select:focus,
textarea:focus,
[tabindex]:focus,
.interactive:focus {
  outline: 2px solid var(--matrix-green-bright);
  outline-offset: 2px;
  box-shadow: 
    0 0 0 4px rgba(0, 255, 0, 0.3),
    0 0 15px var(--phosphor-glow);
  position: relative;
  z-index: calc(var(--z-ui) + 10);
}

button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[tabindex]:focus-visible,
.interactive:focus-visible {
  outline: 3px solid var(--matrix-green-bright);
  outline-offset: 3px;
  box-shadow: 
    0 0 0 6px rgba(0, 255, 0, 0.4),
    0 0 20px var(--phosphor-glow);
}

/* Skip to Content Link */
.skip-to-content {
  position: absolute;
  top: -40px;
  left: 6px;
  background: var(--matrix-green);
  color: var(--terminal-black);
  padding: 8px 16px;
  text-decoration: none;
  font-family: var(--font-terminal);
  font-size: 14px;
  font-weight: bold;
  border-radius: 4px;
  z-index: 9999;
  transition: top 0.3s ease;
  border: 2px solid var(--matrix-green-bright);
}

.skip-to-content:focus {
  top: 6px;
  outline: 2px solid var(--terminal-black);
  outline-offset: 2px;
}

/* Focus Trap for Modal-like Behavior */
.focus-trap {
  position: relative;
}

.focus-trap:focus-within {
  outline: 1px dashed var(--matrix-green-dim);
  outline-offset: 4px;
}

/* Enhanced Keyboard Navigation Indicators */
.message-popup[data-keyboard-dismissible="true"]::after {
  content: '';
  position: absolute;
  top: -2px;
  right: -2px;
  width: 8px;
  height: 8px;
  background: var(--matrix-green-bright);
  border-radius: 50%;
  box-shadow: 0 0 5px var(--matrix-green-bright);
  animation: keyboard-indicator-pulse 2s ease-in-out infinite;
}

@keyframes keyboard-indicator-pulse {
  0%, 100% {
    opacity: 0.6;
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(1.2);
  }
}

/* Keyboard Navigation Help Overlay */
.keyboard-help-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.keyboard-help-overlay.visible {
  opacity: 1;
  visibility: visible;
}

.keyboard-help-content {
  background: var(--terminal-black);
  border: 2px solid var(--matrix-green);
  border-radius: 8px;
  padding: 24px;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 0 30px var(--phosphor-glow);
}

.keyboard-help-title {
  font-size: var(--font-size-xl);
  color: var(--matrix-green-bright);
  margin-bottom: 16px;
  text-align: center;
  text-shadow: var(--text-shadow-strong);
}

.keyboard-shortcuts {
  display: grid;
  gap: 12px;
  margin-bottom: 20px;
}

.shortcut-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: rgba(0, 255, 0, 0.05);
  border: 1px solid var(--matrix-green-dark);
  border-radius: 4px;
}

.shortcut-key {
  font-family: var(--font-terminal);
  font-weight: bold;
  color: var(--matrix-green-bright);
  background: rgba(0, 255, 0, 0.1);
  padding: 4px 8px;
  border-radius: 4px;
  border: 1px solid var(--matrix-green-dim);
  min-width: 80px;
  text-align: center;
}

.shortcut-description {
  color: var(--matrix-green);
  flex: 1;
  margin-left: 16px;
  font-size: var(--font-size-sm);
}

.keyboard-help-close {
  background: transparent;
  border: 1px solid var(--matrix-green);
  color: var(--matrix-green);
  padding: 8px 16px;
  border-radius: 4px;
  font-family: var(--font-terminal);
  cursor: pointer;
  transition: all 0.2s ease;
  display: block;
  margin: 0 auto;
}

.keyboard-help-close:hover,
.keyboard-help-close:focus {
  background: var(--matrix-green-dark);
  box-shadow: 0 0 10px var(--phosphor-glow);
  color: var(--matrix-green-bright);
}

/* Keyboard Navigation Status Indicator */
.keyboard-nav-status {
  position: fixed;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.8);
  border: 1px solid var(--matrix-green-dim);
  border-radius: 4px;
  padding: 4px 8px;
  font-family: var(--font-terminal);
  font-size: 10px;
  color: var(--matrix-green-dim);
  z-index: 9998;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.keyboard-nav-status.active {
  opacity: 1;
}

.keyboard-nav-status::before {
  content: '‚å® ';
  color: var(--matrix-green);
}

/* Container Focus Management */
.message-popup-container:focus {
  outline: 2px dashed var(--matrix-green-dim);
  outline-offset: 4px;
}

.message-popup-container:focus-visible {
  outline: 3px dashed var(--matrix-green);
  outline-offset: 6px;
}

/* Accessibility Status Indicators */
.message-popup[data-high-contrast="true"]::before {
  content: 'HC';
  position: absolute;
  top: -8px;
  left: -8px;
  background: var(--matrix-green);
  color: var(--terminal-black);
  font-size: 8px;
  font-weight: bold;
  padding: 2px 4px;
  border-radius: 2px;
  font-family: var(--font-terminal);
  z-index: 1;
}

.message-popup[data-reduced-motion="true"]::before {
  content: 'RM';
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--matrix-green-dim);
  color: var(--terminal-black);
  font-size: 8px;
  font-weight: bold;
  padding: 2px 4px;
  border-radius: 2px;
  font-family: var(--font-terminal);
  z-index: 1;
}

/* Touch Device Accessibility */
@media (pointer: coarse) {
  .message-popup {
    min-height: 44px;
    min-width: 44px;
    padding: 12px 16px;
  }

  .message-popup:focus {
    outline-width: 4px;
    outline-offset: 4px;
  }

  .message-popup-speechBubble {
    min-height: 48px;
    padding: 14px 18px;
  }

  .message-popup-overlay {
    min-height: 52px;
    padding: 16px 20px;
  }
}

/* Voice Control Support */
.message-popup[aria-label] {
  /* Ensure voice control can target messages */
  position: relative;
}

.message-popup-content[role="text"] {
  /* Ensure content is read as continuous text */
  display: inline;
}

/* Enhanced Screen Reader Optimizations */
.message-popup-prompt {
  /* Style for decorative prompt symbol - use aria-hidden="true" in HTML */
  font-weight: bold;
  color: var(--matrix-green-bright);
}

.message-popup-tail {
  /* Style for decorative speech bubble tail - use aria-hidden="true" in HTML */
  pointer-events: none;
}

.message-popup-content {
  /* Ensure content is properly styled for screen readers - use role="text" in HTML */
  line-height: 1.4;
  word-wrap: break-word;
}

/* Screen reader announcement classes */
.sr-announcement {
  /* For important announcements */
  font-weight: bold;
}

.sr-status {
  /* For status updates */
  font-style: italic;
}

.sr-alert {
  /* For alert messages */
  text-transform: uppercase;
}

/* Screen Reader Live Regions */
.sr-live-region {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.sr-live-polite {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

.sr-live-assertive {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Screen Reader Navigation Landmarks */
.sr-landmark-main {
  /* Main content landmark - use with role="main" */
  outline: none;
}

.sr-landmark-navigation {
  /* Navigation landmark - use with role="navigation" */
  outline: none;
}

.sr-landmark-complementary {
  /* Complementary content landmark - use with role="complementary" */
  outline: none;
}

.sr-landmark-banner {
  /* Banner landmark - use with role="banner" */
  outline: none;
}

.sr-landmark-contentinfo {
  /* Content info landmark - use with role="contentinfo" */
  outline: none;
}

/* Print Accessibility */
@media print {
  .message-popup {
    position: static !important;
    background: white !important;
    color: black !important;
    border: 2px solid black !important;
    box-shadow: none !important;
    margin: 10px 0 !important;
    page-break-inside: avoid;
  }

  .message-popup-prompt {
    color: black !important;
  }

  .message-popup-content {
    color: black !important;
  }

  .message-popup-tail {
    display: none !important;
  }

  .sr-only {
    position: static !important;
    width: auto !important;
    height: auto !important;
    clip: none !important;
    overflow: visible !important;
    white-space: normal !important;
    font-size: 10px !important;
    color: #666 !important;
    font-style: italic !important;
  }
}

/* Color Blind Accessibility */
@media (prefers-color-scheme: no-preference) {
  .message-popup-mode-corporate-ai {
    border-style: solid;
  }

  .message-popup-mode-zen-monk {
    border-style: dashed;
  }

  .message-popup-mode-chaos {
    border-style: dotted;
  }

  .message-popup-mode-emotional-damage {
    border-style: double;
  }
}

/* Responsive Accessibility */
@media (max-width: 768px) {
  .message-popup:focus {
    outline-width: 3px;
    outline-offset: 3px;
  }

  .message-popup[data-keyboard-dismissible="true"]::after {
    width: 10px;
    height: 10px;
    top: -3px;
    right: -3px;
  }
}

@media (max-width: 480px) {
  .message-popup {
    min-height: 48px;
  }

  .message-popup:focus {
    outline-width: 4px;
    outline-offset: 4px;
  }

  .message-popup[data-high-contrast="true"]::before,
  .message-popup[data-reduced-motion="true"]::before {
    display: none;
  }
}

/* Battery Saving Mode */
@media (prefers-reduced-data: reduce) {
  .message-popup {
    box-shadow: none !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  .message-popup-scan-lines::before,
  .message-popup-phosphor-persistence::after {
    display: none !important;
  }
}

/* Forced Colors Mode (Windows High Contrast) */
@media (forced-colors: active) {
  .message-popup {
    background: Canvas !important;
    color: CanvasText !important;
    border: 2px solid ButtonText !important;
    box-shadow: none !important;
  }

  .message-popup:focus {
    outline: 2px solid Highlight !important;
    outline-offset: 2px !important;
    border-color: Highlight !important;
  }

  .message-popup-prompt {
    color: CanvasText !important;
    text-shadow: none !important;
  }

  .message-popup-content {
    color: CanvasText !important;
  }

  .message-popup-tail {
    border-color: ButtonText !important;
  }

  .message-popup-scan-lines::before,
  .message-popup-phosphor-persistence::after {
    display: none !important;
  }
}

/* Animation Performance Optimization for Accessibility */
.message-popup[data-reduced-motion="false"] {
  will-change: transform, opacity;
  backface-visibility: hidden;
  perspective: 1000px;
}

.message-popup[data-reduced-motion="true"] {
  will-change: opacity;
  backface-visibility: visible;
  perspective: none;
}

/* Focus Trap for Modal-like Behavior */
.message-popup-container[data-active-messages="1"] .message-popup:focus {
  position: fixed;
  z-index: calc(var(--z-modal) + 10);
}

/* Accessibility Debug Mode (Development Only) */
.accessibility-debug .message-popup {
  outline: 1px dashed red !important;
  outline-offset: 1px !important;
}

.accessibility-debug .message-popup::before {
  content: 'A11Y: ' attr(aria-label) !important;
  position: absolute !important;
  top: -20px !important;
  left: 0 !important;
  background: red !important;
  color: white !important;
  font-size: 10px !important;
  padding: 2px 4px !important;
  border-radius: 2px !important;
  z-index: 1000 !important;
  max-width: 200px !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  white-space: nowrap !important;
}

.accessibility-debug .sr-only {
  position: static !important;
  width: auto !important;
  height: auto !important;
  clip: none !important;
  overflow: visible !important;
  background: yellow !important;
  color: black !important;
  border: 1px solid red !important;
  padding: 2px !important;
  margin: 2px !important;
}
}